<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- å…è¨± inline script/style -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
  <title>ä¾†é€Ÿå’–å•¡å³æ™‚æŠ½ç</title>
  <style>
    body {
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      background: #f7f2eb;
      color: #3e2f1c;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }
    /* æ–°å¢ï¼šé è¨­éš±è—â€œå·²æŠ½éâ€æç¤º */
    #already {
      display: none;
      font-size: 1em;
      color: #333;
      margin-bottom: 10px;
    }
    .result-box {
      border: 2px solid #6f4e37;
      border-radius: 12px;
      padding: 30px;
      background: #fffaf6;
      max-width: 400px;
      width: 100%;
      text-align: center;
      margin-bottom: 20px;
    }
    .result-box h1 { font-size: 2em; margin-bottom: 10px; }
    .result-box .time { font-size: 0.9em; color: #555; margin-bottom: 20px; }
    .result-box p { font-size: 1.2em; margin: 10px 0; }
    .note {
      font-size: 1em;
      color: #8a2b06;
      margin: 20px 0;
      line-height: 1.5;
    }
    .btn {
      padding: 12px 24px;
      background: #6f4e37;
      color: #fff;
      border-radius: 8px;
      font-size: 1.1em;
      text-decoration: none;
    }
    .btn:hover { background: #5a3f2a; }
  </style>
</head>
<body>

  <div id="already">â€» æ‚¨å·²ç¶“æŠ½éçï¼Œçµæœå¦‚ä¸‹ï¼š</div>
  <div class="result-box" id="resultBox">è¼‰å…¥ä¸­â€¦</div>

  <div class="note">
    è«‹å…ˆ<span style="font-weight:bold;">æˆªåœ–</span>ä¸Šè¿°çµæœï¼Œå†é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«è¡¨å–®ã€‚<br>
    ï¼ˆè‡³åŠ æ²¹ç«™å…Œæ›ä¸­æ¯ç¾å¼ä¹™æ¯ï¼Œè«‹å‡ºç¤ºä¸­çæˆªåœ–åŠä¹‹å‰å’–å•¡æ¶ˆè²»æ˜ç´°æˆ–ç™¼ç¥¨ï¼‰
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      // â€”â€” è«‹æ›¿æ›é€™å…©é … â€”â€” 
      const formBase = "https://docs.google.com/forms/d/e/1FAIpQLSfZNiHHdxGeqTfiOMAmvnGNsU-lKiuZ65KjAgO0eeL27GnjZg/viewform";
      const entryKey = "entry.1234567890"; // â† æ›æˆä½ çš„ã€Œæ‚¨æ˜¯å¦ä¸­çï¼Ÿã€æ¬„ä½ entry ID
      // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

      // è®€å– localStorage
      let data = null;
      try {
        data = JSON.parse(localStorage.getItem("lotteryData"));
      } catch (e) { /* ignore */ }

      const alreadyDiv = document.getElementById("already");

      // ç¬¬ä¸€æ¬¡æˆ–å°šæœªå­˜éçµæœï¼šæŠ½çä¸¦å­˜é€² localStorage
      if (!data || typeof data.isWinner === "undefined") {
        const isWinner = Math.random() < 0.3; // 30% æ©Ÿç‡å¯è‡ªè¡Œèª¿æ•´
        const now = new Date();
        const pad = n => String(n).padStart(2, "0");
        const timeStr =
          `${now.getFullYear()}/${pad(now.getMonth()+1)}/${pad(now.getDate())} ` +
          `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
        data = { isWinner, timeStr };
        localStorage.setItem("lotteryData", JSON.stringify(data));
      } else {
        // è‹¥å·²æœ‰è¨˜éŒ„ï¼Œé¡¯ç¤ºâ€œå·²æŠ½éâ€æç¤º
        alreadyDiv.style.display = "block";
      }

      // é¡¯ç¤ºæŠ½ççµæœ
      const box = document.getElementById("resultBox");
      if (data.isWinner) {
        box.innerHTML = `
          <h1>ğŸ‰ æ­å–œä½ ä¸­çäº†ï¼</h1>
          <div class="time">é–‹çæ™‚é–“ï¼š${data.timeStr}</div>
          <p>å¡«å¯«è¡¨å–®å³å¯å…Œæ›å…è²»ä¸­æ¯ç¾å¼ä¹™æ¯</p>`;
      } else {
        box.innerHTML = `
          <h1>ğŸ˜¢ å¾ˆå¯æƒœé€™æ¬¡æ²’ä¸­çå–”ï¼</h1>
          <div class="time">é–‹çæ™‚é–“ï¼š${data.timeStr}</div>
          <p>å¡«å¯«å•å·å¾Œå¯ç²å¾—ä¸­æ¯ç¾å¼5å…ƒæŠ˜åƒ¹åˆ¸</p>`;
      }

      // å»ºç«‹ã€Œå¡«è¡¨ã€æŒ‰éˆ•
      const btn = document.createElement("a");
      btn.className = "btn";
      btn.textContent = "ğŸ‘‰ é»æˆ‘å¡«è¡¨å–®";
      btn.href = `${formBase}?${entryKey}=${data.isWinner ? "ä¸­ç" : "æœªä¸­"}`;
      btn.target = "_blank";
      document.body.appendChild(btn);
    });
  </script>

</body>
</html>